var WC_PPP_Brasil_Checkout=function(){function e(){var a=this;this.onSubmitForm=function(e){var t=jQuery("#payment_method_"+wc_ppp_brasil_data.id+":checked");a.log("info","Checking if PayPal Payment method is checked..."),a.log("data",!!t.length),jQuery("#payment_method_"+wc_ppp_brasil_data.id).length||a.log("error","PayPal Plus check button wasn't detected. Should have an element #payment_method_"+wc_ppp_brasil_data.id),wc_ppp_brasil_data.order_pay&&a.$form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),a.forceSubmit&&t.length?a.log("info","Form will be forced to submit."):t.length&&a.log("info","Form won't be forced to submit, will try to contact PayPal iframe first."),!a.forceSubmit&&t.length&&(e.preventDefault(),e.stopImmediatePropagation(),a.instance?a.instance.doContinue():a.log("error","We don't have the iframe instance, something wrong may have occurred. May be the fields isn't fulfilled."))},this.updateCheckout=function(e){void 0===e&&(e=null),e&&e.preventDefault(),a.triggerUpdateCheckout()},this.triggerUpdateCheckout=this.debounce(function(){a.log("info","Updating checkout..."),a.$body.trigger("update_checkout")},1e3),this.onUpdatedCheckout=function(){a.$inputData=jQuery("#wc-ppp-brasil-data"),a.$inputResponse=jQuery("#wc-ppp-brasil-response"),a.$inputError=jQuery("#wc-ppp-brasil-error"),a.$inputSubmit=jQuery("#place_order"),a.$inputSubmit.length||a.log("error","Input submit wasn't found. Should have the #place_order element in the form."),a.$overlay=jQuery("#wc-ppb-brasil-container-overlay"),a.$loading=jQuery("#wc-ppp-brasil-container-loading"),a.$containerDummy=jQuery("#wc-ppp-brasil-container-dummy"),a.$overlay.on("click","[data-action=update-checkout]",a.updateCheckout),a.showOverlay();var t=a.$inputData.val(),e=jQuery("#wc-ppp-brasil-api-error-data").val();e&&(a.log("error","There was an error with following data:"),a.log("data",JSON.parse(e)));try{if(t){var o=JSON.parse(t);a.log("info","Creating iframe with data:"),a.log("data",o),0!==o.invalid.length&&(a.log("error","There's some invalid data. Iframe will render dummy version:"),a.log("data",o.invalid)),a.createIframe(o)}}catch(e){a.log("error","There was some error creating the iframe."),a.log("info","Data received:"),a.log("data",t),a.log("info","Error:"),a.log("data",e)}},this.messageListener=function(e){try{var t=JSON.parse(e.data);a.log("info","Received a message:"),a.log("data",t)}catch(e){}},this.log("heading","PayPal Plus logging enabled\n"),this.log("info","Backend data:"),this.log("data",wc_ppp_brasil_data),this.$body=jQuery(document.body),this.$body.length?this.log("info","HTML body detected."):this.log("error","HTML body didn't detected."),this.$form=wc_ppp_brasil_data.order_pay?jQuery("form#order_review"):jQuery("form.checkout.woocommerce-checkout"),wc_ppp_brasil_data.order_pay?this.log("info","Running script as order pay."):this.log("info","Running script as order review."),this.$form.length?(this.log("info","Detected form.checkout.woocommerce-checkout element."),this.log("data",this.$form)):this.log("error","Didn't detect form.checkout.woocommerce-checkout element."),this.listenInputChanges(),this.$body.on("updated_checkout",this.onUpdatedCheckout),this.$form.on("submit",this.onSubmitForm),wc_ppp_brasil_data.debug_mode&&window.addEventListener("message",this.messageListener,!1),wc_ppp_brasil_data.order_pay&&jQuery(function(e){jQuery("body").trigger("updated_checkout")})}return e.prototype.listenInputChanges=function(){var e=this,t=["[name=billing_first_name]","[name=billing_last_name]","[name=billing_cpf]","[name=billing_cnpj]","[name=billing_phone]","[name=billing_address_1]","[name=billing_number]","[name=billing_address_2]","[name=billing_neighborhood]","[name=billing_city]","[name=billing_state]","[name=billing_country]","[name=billing_email]"],o=["[name=billing_persontype]"];jQuery(t.join(",")).on("keyup",function(){return e.updateCheckout()}),this.log("info","Listening for keyup to following elements:"),this.log("data",t),jQuery(o.join(",")).on("change",function(){return e.updateCheckout()}),this.log("info","Listening for change to following elements:"),this.log("data",o)},e.prototype.createIframe=function(e){var i=this;if(e.dummy)this.$containerDummy.removeClass("hidden");else{this.hideOverlay(),this.showLoading();var t={approvalUrl:e.approval_url,placeholder:"wc-ppp-brasil-container",mode:wc_ppp_brasil_data.mode,payerFirstName:e.first_name,payerLastName:e.last_name,payerPhone:e.phone,language:wc_ppp_brasil_data.language,country:wc_ppp_brasil_data.country,payerEmail:e.email,rememberedCards:e.remembered_cards,onError:function(e){console.log("There was an error: ",e);var t=JSON.stringify(e.cause);i.treatIframeError(t)},enableContinue:function(e){console.log("enableContinue",e),i.enableSubmitButton()},disableContinue:function(e){console.log("disableContinue",e),i.disableSubmitButton()},onLoad:function(){return i.hideLoading()},onContinue:function(e,t,o,a){var r={payer_id:t,remembered_cards_token:e,term:a,token:o};i.log("Continue allowed:",r),i.$inputResponse.val(JSON.stringify(r)),i.forceSubmitForm()}};wc_ppp_brasil_data.form_height&&(t.iframeHeight=wc_ppp_brasil_data.form_height),wc_ppp_brasil_data.show_payer_tax_id?(t.payerTaxId="1"===e.person_type?e.cpf:e.cnpj,t.payerTaxIdType="1"===e.person_type?"BR_CPF":"BR_CNPJ"):t.payerTaxId="",this.log("info","Settings for iframe:"),this.log("data",t),this.instance=PAYPAL.apps.PPP(t),this.$inputError.val(""),this.$inputResponse.val(""),this.forceSubmit=!1}},e.prototype.hideOverlay=function(){this.$overlay.addClass("hidden")},e.prototype.showOverlay=function(){this.$overlay.removeClass("hidden")},e.prototype.hideLoading=function(){},e.prototype.showLoading=function(){},e.prototype.treatIframeError=function(e){var t=e.replace(/[^\sA-Za-z0-9_]+/g,"");switch(t){case"CHECK_ENTRY":this.showMessage('<div class="woocommerce-error">'+wc_ppp_brasil_data.messages.check_entry+"</div>");break;default:this.log("This message won't be treated, so form will be submitted."),this.$inputError.val(t),this.forceSubmitForm()}},e.prototype.disableSubmitButton=function(){this.$inputSubmit.prop("disabled",!0)},e.prototype.enableSubmitButton=function(){this.$inputSubmit.prop("disabled",!1)},e.prototype.forceSubmitForm=function(){this.forceSubmit=!0,this.$form.submit()},e.prototype.showMessage=function(e){var t=jQuery("form.checkout");t.length||this.log("error","Isn't possible to find the form.checkout element."),jQuery(".woocommerce-error, .woocommerce-message").remove(),e&&(t.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-updateOrderReview">'+e+"</div>"),t.find(".input-text, select, input:checkbox").blur(),jQuery("html, body").animate({scrollTop:t.offset().top-100},1e3))},e.prototype.debounce=function(a,r,i){var n;return void 0===i&&(i=!1),function(){var e=this,t=arguments,o=i&&!n;clearTimeout(n),n=setTimeout(function(){n=null,i||a.apply(e,t)},r),o&&a.apply(e,t)}},e.prototype.log=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];if(wc_ppp_brasil_data.debug_mode)switch(e){case"heading":pwc().color("#003087").size(25).bold().log(t);break;case"log":pwc().log(t);break;case"info":pwc().bold().italic().color("#009cde").info(t);break;case"warn":pwc().warn(t);break;case"error":pwc().error(t);break;case"data":t.forEach(function(e){return console.log(e)});break;case"custom-message":pwc().color("#012169").bold().italic().log(t)}},e}();window.paypalPlusBrasil=new WC_PPP_Brasil_Checkout;